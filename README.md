# mlp-data-intro

## Project Overview

This repository contains the academic paper data and code for "Tracking Civic Space in Developing Countries with a High-Quality Corpus of Domestic Media and Transformer Models". It hosts everything associated with the MLP (Machine Learning for Peace) data introduction paper. The dataset covers 65 developing countries across regions: Eastern Europe/Central Asia, MENA, Latin America & Caribbean, East Asia, Sub-Saharan Africa.

Current Overleaf Location: https://www.overleaf.com/9891685827jxbvnrshzxbw#683bc8

### Event Categories
- **Civic events**: 20 categories including arrest, censor, protest, activism, coup, etc.
  - **CR variables**: Subset of civic events that are considered civil rights related
- **RAI events**: 22 categories of international influence including arms transfers, diplomatic activities, economic aid

## Source Management

### Source-types
- **International sources**: 16 major outlets (BBC, Reuters, NYT, etc.)
- **Regional sources**: 12 regional outlets
- **Local sources**: Country-specific outlets

### Source Metadata
- `/source_metadata/` folder contains detailed data on the ownership and bias of local sources, including definitions and coding materials

## Key Architecture

### Data Structure
- **`data/0-civic-by-source/`** and **`data/0-rai-by-source-and-influencer/`**: Source-level data
  - `[countryname].csv`: Per-country data files
  - Variables with `Norm` suffix: Raw counts normalized by `article_total`, which counts the number of articles published about that country per country-month.
  - Variables with `_ncr` suffix: Non-politically relevant events filtered out
- **`data/1-civic-aggregate/`**: Civic events aggregated to country-month level
  - `[countryname].csv`: Per-country data files with both raw counts and normalized versions
- **`data/1-rai-aggregate/`**: RAI events aggregated by influencer
  - `[countryname]_[influencer].csv`: Separate files for each country-influencer combination (e.g., `Belarus_russia.csv`, `Belarus_china.csv`)
  - Includes pre-calculated RAI theme aggregations (hard power, soft power, diplomacy, etc.) based on `data/rai_vars.csv`
  - Variables with `Norm` suffix: Raw counts normalized by `article_total`
  - Variables with `_ncr` suffix: Non-politically relevant events filtered out
- **`data/final-counts/`**: Raw and normalized article counts by country-month
  - `full-data.rds` and `full-data.csv`: Complete dataset across all countries
  - `shock-civic-data.csv`: Combined civic shock detection results across all countries
  - `shock-rai-data.csv`: Combined RAI shock detection results across all countries and influencers
- **`data/2-civic-shock/`** and **`data/2-rai-shock/`**: Shock detection results
  - `[countryname].csv`: Civic event shock detection results
  - `[countryname]_[influencer].csv`: RAI event shock detection results by influencer 

### Source Coverage
`data/1-source_entries.rds` captures the temporal coverage patterns of local news sources across the full time series. Generated by the `update_source_entries()` function, it creates a date Ã— source matrix where each cell contains:
- **1** if the source published articles in that month (total article count > 0)  
- **0** if the source was inactive in that month


This binary activity matrix is essential for tracking source entry/exit patterns over time and understanding changes in media landscape composition that could affect trend interpretation in civic space monitoring. 

### Core Scripts
- **`build_data/build_data.R`**: Main data construction pipeline to generate contents of `/data/`
- **`build_data/constants.R`**: List of event categories, countries, local/regional/international sources
- **`build_data/mlp_functions.R`**: Custom functions for data extraction and aggregation
- **`data/rai_vars.csv`**: Configuration file defining RAI event themes and categorizations

## Shock Detection

The shock detection pipeline identifies significant spikes in civic and RAI event reporting using neural networks and peak detection algorithms.

### Core Components

- **`build_data/shock_detection/shock_detection.py`**: Main shock detection script
  - Processes both civic events and RAI events separately by influencer
  - Uses TensorFlow neural networks combined with conservative peak detection algorithms
  - Generates visualizations and saves results to shock folders
  - Simplified to work directly with normalized event columns

- **`build_data/shock_detection/data.py`**: Configuration and variable definitions
  - `civic`: List of normalized civic event variables (e.g., `arrestNorm`, `protestNorm`)
  - `rai`: List of normalized RAI event variables and pre-calculated themes

- **`build_data/shock_detection/peak_detector.py`**: Peak detection algorithms
- **`build_data/shock_detection/content/model_version1/`**: Pre-trained TensorFlow model for surge prediction

### RAI Theme Integration

RAI events are automatically grouped into thematic categories during data pipeline execution:
- **Hard Power**: Security cooperation, arms transfers, military exercises
- **Soft Power**: Cultural exchanges, diaspora activation, media campaigns  
- **Economic Power**: Trade, investment, economic aid, sanctions
- **Diplomacy**: Recognition, visits, statements, mediation
- **Domestic Interference**: Surveillance, political intervention, intelligence
- **Backlash**: Corruption, organized crime

Theme definitions are configurable via `data/rai_vars.csv` and calculated in `aggregate_and_merge_rai()` function.

### Pipeline Execution

```bash
# Run shock detection on current data
cd build_data/shock_detection
python shock_detection.py
```

The pipeline automatically:
1. **Processes civic events**: Reads from `data/1-civic-aggregate/` and outputs to `data/2-civic-shock/`
2. **Processes RAI events by influencer**: Reads separate influencer files from `data/1-rai-aggregate/` and outputs individual shock detection results
3. **Generates visualizations**: Creates time series plots with detected peaks for each event type
4. **Uses normalized data directly**: No preprocessing required since both civic and RAI data include normalized columns

### Output Structure

- **Civic shocks**: `data/2-civic-shock/[country].csv` - Binary shock indicators for each civic event by month
- **RAI shocks**: `data/2-rai-shock/[country]_[influencer].csv` - Binary shock indicators for each RAI event and theme by month  
- **Visualizations**: PNG plots showing detected peaks overlaid on normalized time series data


## Common Development Tasks

### Data Processing
```r
# Run main data construction pipeline
source("build_data/build_data.R")

```

### Key R Libraries
Core dependencies include: `tidyverse`, `here`, `psych`, `gt`, `kableExtra`, `ggplot2`, `changepoint`


## Important Notes
- All countries have data through 2024-12-01
- Date folder overrides can be specified in `date_folder()` function
- Path configurations in `data_update.R` handle multiple user environments


## Analysis for Manuscript

### GPT Summarization

This folder contains GPT-powered event summarization tools for the MLP project:

- **`GPT code.ipynb`**: Jupyter notebook implementing automated event summarization using OpenAI's GPT models. The script processes civic events detected by the ML4P forecasting system, retrieving relevant news articles from MongoDB and generating human-readable summaries for each event category by country-month. Includes functions for country/source mapping, text preprocessing, and two-stage summarization (event listing + final synthesis).

- **`event_prompts.csv`**: Contains templated prompts for 20 different civic event types (arrest, protest, corruption, etc.) with both detailed and concise prompt variations. Each prompt guides GPT to extract, rank, and summarize the most significant events while filtering out irrelevant or misplaced content.

### geoparsing_test

This folder evaluates geographic location extraction performance comparing CLIFF and GPT-4 systems:

- **`GPT Geoparsing.py`**: Python script using OpenAI's GPT-4 to extract geographic locations from news articles. Processes article text to identify the most specific location mentioned and complete the administrative hierarchy (country, admin1, admin2 levels) based on global administrative division knowledge.

- **`Geoparsing_report.Rmd`**: R Markdown analysis comparing CLIFF vs GPT performance on geographic entity extraction from 250 Colombian news articles. Evaluates accuracy across different administrative levels, categorizes errors by type (ambiguity, hierarchical misclassification, context disambiguation), and provides comprehensive performance metrics.

- **`Geoparsing_GPT_CLIFF.xlsx`**: Dataset containing results from both CLIFF and GPT geoparsing systems with human-coded ground truth for validation.

