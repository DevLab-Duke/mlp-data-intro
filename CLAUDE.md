# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This repository contains the academic paper data and code for "Tracking Civic Space in Developing Countries with a High-Quality Corpus of Domestic Media and Transformer Models". It hosts everything associated with the MLP (Machine Learning for Peace) data introduction paper. The dataset covers 65 developing countries across regions: Eastern Europe/Central Asia, MENA, Latin America & Caribbean, East Asia, Sub-Saharan Africa.


### Event Categories
- **Civic events**: 20 categories including arrest, censor, protest, activism, coup, etc.
  - **CR variables**: Subset of civic events that are considered civil rights related
- **RAI events**: 22 categories of international influence including arms transfers, diplomatic activities, economic aid

## Source Management
- **International sources**: 16 major outlets (BBC, Reuters, NYT, etc.)
- **Regional sources**: 12 regional outlets
- **Local sources**: Country-specific outlets
- Source entry/exit tracking in final dataset columns for composition change detection


## Key Architecture

### Data Structure
- **`data/0-civic-by-source/`** and **`data/0-rai-by-source-and-influencer/`**: Source-level data
  - `[countryname].csv`: Per-country data files
  - Variables with `Norm` suffix: Raw counts normalized by `article_total`, which counts the number of articles published about that country per country-month.
  - Variables with `_ncr` suffix: Non-politically relevant events filtered out
- **`data/1-civic-aggregate/`** and **`data/1-rai-aggregate/`**: Aggregated country-month data
  - `[countryname].csv`: Per-country data files
  - Variables with `Norm` suffix: Raw counts normalized by `article_total`, which counts the number of articles published about that country per country-month.
  - Variables with `_ncr` suffix: Non-politically relevant events filtered out
- **`data/final-counts/`**: Raw and normalized article counts by country-month
  - `full-data.rds` and `full-data.csv`: Complete dataset across all countries
- **`data/shocks/`**: Event detection algorithm results showing major jumps in reporting (event salience) 

### Source Coverage
`data/1-source_entries.rds` captures the temporal coverage patterns of local news sources across the full time series. Generated by the `update_source_entries()` function, it creates a date Ã— source matrix where each cell contains:
- **1** if the source published articles in that month (total article count > 0)  
- **0** if the source was inactive in that month

This binary activity matrix is essential for tracking source entry/exit patterns over time and understanding changes in media landscape composition that could affect trend interpretation in civic space monitoring. 

### Core Scripts
- **`build_data/build_data.R`**: Main data construction pipeline to generate contents of `/data/`
- **`build_data/constants.R`**: List of event categories, countries, local/regional/international sources
- **`build_data/mlp_functions.R`**: Custom functions for data extraction and aggregation


## Common Development Tasks

### Data Processing
```r
# Run main data construction pipeline
source("build_data/build_data.R")

```

### Key R Libraries
Core dependencies include: `tidyverse`, `here`, `psych`, `gt`, `kableExtra`, `ggplot2`, `changepoint`


## Important Notes
- All countries have data through 2024-12-01
- Date folder overrides can be specified in `date_folder()` function
- Path configurations in `data_update.R` handle multiple user environments
